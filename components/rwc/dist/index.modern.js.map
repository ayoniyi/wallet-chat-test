{"version":3,"file":"index.modern.js","sources":["../src/ButtonOverlay/ButtonOverlay.jsx","../src/utils/index.js","../src/WalletChat/WalletChat.jsx"],"sourcesContent":["import React from 'react'\n// import \"./ButtonOverlay.css\"\nimport styles from './ButtonOverlay.module.css'\n\n\nexport default function ButtonOverlay({ notiVal, showNoti, isOpen, clickHandler }) {\n    console.log(`showNoti: ${showNoti}`)\n    console.log(`notiVal: ${notiVal}`)\n\n    return (\n        <div className={styles.popupButton__container}>\n            <div className={styles.popupButton} onClick={clickHandler}>\n                <div className={!isOpen ? `${styles.icon} ${styles.activeIcon}` : `${styles.icon}`}>\n                    <img src=\"https://uploads-ssl.webflow.com/62d761bae8bf2da003f57b06/62d761bae8bf2dea68f57b52_walletchat%20logo.png\" style={{\n                        height: \"90%\"\n                    }} />\n                    {/* <svg focusable=\"false\" aria-hidden=\"true\" viewBox=\"0 0 28 32\" width=\"28\" height=\"32\"><path d=\"M28,32 C28,32 23.2863266,30.1450667 19.4727818,28.6592 L3.43749107,28.6592 C1.53921989,28.6592 0,27.0272 0,25.0144 L0,3.6448 C0,1.632 1.53921989,0 3.43749107,0 L24.5615088,0 C26.45978,0 27.9989999,1.632 27.9989999,3.6448 L27.9989999,22.0490667 L28,22.0490667 L28,32 Z M23.8614088,20.0181333 C23.5309223,19.6105242 22.9540812,19.5633836 22.5692242,19.9125333 C22.5392199,19.9392 19.5537934,22.5941333 13.9989999,22.5941333 C8.51321617,22.5941333 5.48178311,19.9584 5.4277754,19.9104 C5.04295119,19.5629428 4.46760991,19.6105095 4.13759108,20.0170667 C3.97913051,20.2124916 3.9004494,20.4673395 3.91904357,20.7249415 C3.93763774,20.9825435 4.05196575,21.2215447 4.23660523,21.3888 C4.37862552,21.5168 7.77411059,24.5386667 13.9989999,24.5386667 C20.2248893,24.5386667 23.6203743,21.5168 23.7623946,21.3888 C23.9467342,21.2215726 24.0608642,20.9827905 24.0794539,20.7254507 C24.0980436,20.4681109 24.0195551,20.2135019 23.8614088,20.0181333 Z\"></path></svg> */}\n                </div>\n                <div className={isOpen ? `${styles.icon} ${styles.activeIcon}` : `${styles.icon}`}>\n                    <svg focusable=\"false\" viewBox=\"0 0 16 14\" width=\"28\" height=\"25\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M.116 4.884l1.768-1.768L8 9.232l6.116-6.116 1.768 1.768L8 12.768.116 4.884z\"></path></svg>\n                </div>\n            </div>\n            {showNoti && (\n                <div className={styles.notif}>\n                    {notiVal}\n                </div>\n            )}\n\n        </div>\n    )\n}\n","const getCookie = (cname) => {\n    let name = cname + \"=\";\n    let iframe = document.getElementById(\"wallet-chat-widget\")\n    console.log(iframe)\n    console.log(iframe.contentDocument)\n    let cookies = iframe.contentDocument.cookie || document.cookie;\n    console.log(cookies)\n    console.log(document.cookie)\n    let decodedCookie = decodeURIComponent(cookies);  //#\n    let ca = decodedCookie.split(';');\n    for(let i = 0; i <ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) == ' ') {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) == 0) {\n        return c.substring(name.length, c.length);\n      }\n    }\n    return \"\";\n  }\n\n  function setCookie(cname, cvalue) {\n    document.cookie = cname + \"=\" + cvalue;\n    console.log(\"Cookies now\")\n    console.log(document.cookie)\n}\n\n\n\nexport { getCookie, setCookie}","import React, { useEffect, useState } from \"react\";\nimport ButtonOverlay from \"../ButtonOverlay/ButtonOverlay\";\n// import \"./WalletChat.css\"\nimport styles from \"./WalletChat.module.css\";\nimport { getCookie, setCookie } from \"../utils\";\n\nconst setExtChatAddr = (setState) => {\n  return (addr) => {\n    setState(undefined)\n    setState(addr)\n  }\n}\nconst openChat = (addr) => {\n}\n// {chatAddr, setChatAddr, isOpen, setIsOpen}\nfunction WalletChatWidget({ widgetState }) {\n  //console.log(\"WalletChatWidget Render\")\n  //console.log(widgetState)\n  const [isOpen, setIsOpen] = useState(widgetState?.isOpen)\n  const [chatAddr, setChatAddr] = useState(widgetState?.chatAddr)\n  const [hideIframe, setHideIframe] = useState(false);\n  const [numUnread, setNumUnread] = useState(0);\n  let url = process.env.REACT_APP_APP_URL || \"https://v1.walletchat.fun\" \n  const iframe_url = process.env.REACT_APP_APP_URL || \"https://v1.walletchat.fun\" \n  \n  useEffect(() => {\n    try {\n      if (widgetState?.signature) { \n        console.log(\"useEffect signIn\")\n          const authSig = {\n            sig: widgetState.signature,\n            derivedVia: \"web3.eth.personal.sign\",\n            signedMessage: widgetState.messageToSign,\n            address: widgetState.address.toLocaleLowerCase(),\n          };\n          //end SIWE and authSig\n          //const signature = await _signer.signMessage(_nonce)\n          console.log('âœ…[INFO][AuthSig]:', authSig)\n          // fetch(`${process.env.REACT_APP_REST_API}/signin`, {\n          //   body: JSON.stringify({ \"name\": widgetState.chainId.toString(), \"address\": widgetState.address, \"nonce\": widgetState.nonce, \"msg\": widgetState.messageToSign, \"sig\": widgetState.signature }),\n          //   headers: {\n          //   'Content-Type': 'application/json'\n          //   },\n          //   method: 'POST'\n          // })\n          // .then((response) => response.json())\n          // .then(async (returnData) => {\n          //   localStorage.setItem('jwt', returnData.access);\n          //   //Used for LIT encryption authSign parameter\n          //   localStorage.setItem('lit-auth-signature', JSON.stringify(authSig));\n          //   localStorage.setItem('lit-web3-provider', widgetState.provider);\n          //   console.log('âœ…[INFO][JWT]:', returnData.access)\n          // })\n          let iframe = document.getElementById(\"wallet-chat-widget\")\n          let msg = {\n            \"data\": widgetState,\n            \"target\": \"sign_in\"\n        }\n        iframe.contentWindow.postMessage(msg, iframe_url); //targertOrigin \n      } else {\n    console.log(\"useEffect widgetState\")\n    setIsOpen(widgetState?.isOpen)\n    setChatAddr(widgetState?.chatAddr)\n    setHideIframe(true)\n    setTimeout(() => {\n      setHideIframe(false)\n    }, 100)\n      }\n    } catch (error) {\n      console.log('ðŸš¨widgetConnectError', error)\n  } \n  }, [\n    widgetState\n  ])\n  \n  console.log(`url: ${url}`);\n  const clickHandler = (e) => {\n    setIsOpen(!isOpen);\n  };\n\n  if (chatAddr != undefined && chatAddr.length != 0){\n    url += `/dm/${chatAddr}`\n  }\n  console.log(`url: ${url}`);\n  url = { val: url }\n  useEffect(() => {\n    window.addEventListener(\"message\", (e) => {\n      var data = e.data;\n      console.log(\"RECEIVED message from CHILD TO PARENT\");\n      console.log(data);\n      if(data[\"target\"] == 'unread_cnt'){\n        setNumUnread(data[\"data\"]);\n        setCookie(\"unreadMsgs\", data[\"data\"])\n      }\n      \n    });\n  }, []);\n\n  return (\n    <div id={styles[\"wallet-chat-widget__container\"]}>\n      {/* {isOpen && (\n                <iframe id=\"wallet-chat-widget\" src={url}></iframe>\n            )} */}\n      {!hideIframe &&\n      <iframe\n        id=\"wallet-chat-widget\"\n        className={styles[\"wallet-chat-widget\"]}\n        style={{\n          height: isOpen ? \"\" : \"0px\",\n          width: isOpen ? \"\" : \"0px\",\n          minHeight: isOpen ? \"\" : \"0px\",\n          minWidth: isOpen ? \"\" : \"0px\",\n          // display: isOpen?\"block\":\"none\"\n        }}\n          src={url.val}\n      ></iframe>\n      }\n      <ButtonOverlay\n        notiVal={numUnread}\n        showNoti={numUnread > 0}\n        isOpen={isOpen}\n        clickHandler={clickHandler}\n      />\n    </div>\n  );\n}\nexport default\n  WalletChatWidget\n"],"names":["ButtonOverlay","notiVal","showNoti","isOpen","clickHandler","console","log","styles","popupButton__container","popupButton","icon","activeIcon","height","notif","setCookie","cname","cvalue","document","cookie","WalletChatWidget","widgetState","useState","setIsOpen","chatAddr","setChatAddr","hideIframe","setHideIframe","numUnread","setNumUnread","url","process","env","REACT_APP_APP_URL","iframe_url","useEffect","signature","authSig","sig","derivedVia","signedMessage","messageToSign","address","toLocaleLowerCase","iframe","getElementById","msg","contentWindow","postMessage","setTimeout","error","e","undefined","length","val","window","addEventListener","data","width","minHeight","minWidth"],"mappings":"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"}